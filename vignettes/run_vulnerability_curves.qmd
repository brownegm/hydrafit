---
title: "Fit Vulnerability Curves"
vignette: >
  %\VignetteIndexEntry{Fit Vulnerability Curves}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
knitr:
  opts_chunk:
    collapse: true
    comment: '#>'
---

```{r}
#| label: setup
library(hydrafit)
```

```{r}
data <- scof2012

# outputs for the fits
linear_fits <- list()
logistic_fits <- list()
sigmoidal_fits <- list()
exp1_fits <- list()
exp2_fits <- list()

# fit the models
suppressWarnings({
for (ii in seq_along(unique(data$species))){
  subset(data, data$species == unique(data$species)[ii], select = c(1:ncol(data))) -> data_by_sp

  linear_fits[[ii]] = hydrafit::fit_vuln_curve(input_df = data_by_sp, model_type = "Linear", max_cond_at = 0.1, plot = T)

  logistic_fits[[ii]] = fit_vuln_curve(data_by_sp, model_type = "log", plot=T)

  sigmoidal_fits[[ii]] = fit_vuln_curve(data_by_sp, model_type= "sig", plot=T)

  exp1_fits[[ii]] = fit_vuln_curve(data_by_sp, model_type = "exp", plot=T)

  exp2_fits[[ii]] = fit_vuln_curve(data_by_sp, model_type= "exp2", plot=F)
 }
})

# select best fitting models
best_model <- fx_select(linear_fits, logistic_fits, sigmoidal_fits, exp1_fits, exp2_fits)

# set parameters for the resamples
fit <- best_model[[1]]

# run bootstrap for single fit and list of fits
bootstrap<-bootPX(fit, psi_max=0.1)

bootstrap_list <- bootPX(best_model, psi_max=0.1)
```
